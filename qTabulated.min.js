(function(e,c,a,g){var d="qTable",f={url:null,sort:false,search:false,footer_url:null,transistOut:"zoomOut",rowClick:function(h,i){},pageRows:[20,30,50,100],pgn:5,searchCharacters:3};function b(i,h){this.element=i;this.$element=e(i).clone(true);this.settings=e.extend({},f,h);this.settings.pgn=parseInt(this.settings.pgn)<5?5:parseInt(this.settings.pgn);this.ajax=null;this.page=1;this.pages=0;this.data=[];this.dataCount=0;this.currentData=[];this.filteredData=[];this.overlay=null;this.rows=this.settings.pageRows[0];this._data_parameters();this.init()}e.extend(b.prototype,{init:function(){var k=e('<div class="q-tabulated"></div>'),i=e('<div class="qtable-responsive"></div>'),l=e('<div class="qtable-hc"><label>Rows:<select></select></label></div>'),j=e('<div class="qtable-fc"><div class="qtable-pd"></div><ul class="qtable-pagination"></ul></div>');this.$element.appendTo(i);l.appendTo(k);i.appendTo(k);j.appendTo(k);k.insertAfter(e(this.element));e(this.element).remove();this.$header=l;this.$footer=j;this._header();this._body();this._actions()},_header:function(){var q=this,h=[],r=0;for(var n=0;n<this.settings.pageRows.length;n++){this.$header.find("select").append('<option value="'+this.settings.pageRows[n]+'">'+this.settings.pageRows[n]+"</option>")}this.$element.find("thead>tr:last-child>th").each(function(){r++;if(e(this).data("qoptions")){q._qoptions(e(this),h)}});if(h.length){var o=e('<tr class="q-search"></tr>');for(var m=0;m<r;m++){var p="<th></th>";for(var l=0;l<h.length;l++){if(h[l].i==m){p="<th>"+h[l].f+"</th>";h.splice(l,1);break}}o.append(p)}o.insertAfter(this.$element.find("thead>tr:last-child"))}},_qoptions:function(k,l){var h=k.data("qoptions").split(",");for(var j=0;j<h.length;j++){if(this.ajax&&!k.closest("th,td").data("qname")){continue}switch(h[j].trim()){case"sort":if(k.hasClass("q-sorted")){continue}k.addClass("q-sorted");k.html('<a class="q-sorter" href="javascript:void(0);">'+k.text()+"</a>");break;case"search":if(k.hasClass("q-searched")){continue}k.addClass("q-searched");l.push({i:k.closest("th,td").index(),f:'<input name="qsearch['+(k.closest("th,td").data("qname")&&this.ajax?k.closest("th,td").data("qname"):"")+']">'});break}}},_body:function(){if(!this.$element.find("thead").length){alert("Tables should have <THEAD/> tags!");return}if(!this.$element.find("tbody").length){var h=e("<tbody></tbody>");this.$element.find("thead").siblings().appendTo(h);h.insertAfter(this.$element.find("thead"))}if(this.ajax){this._ajax()}else{this._basic()}},_ajax:function(){var h=this,i={start:((h.page-1)*h.rows),length:h.rows};i=e.extend({},i,this.ajax.data);e.ajax(h.ajax.url,{cache:false,beforeSend:function(){h._overlayStart()},complete:function(){h._overlayStop()},data:i,dataType:"json",error:function(){alert("Error encountered. Log this on https://github.com/angujo/qtable")},method:"get",success:function(j){h.data=j.data;h.dataCount=j.rows;h._setData()}})},_basic:function(){this._overlayStart();var h=[];this.$element.find("tbody>tr").each(function(){var i=[];e(this).find("td,th").each(function(){i.push(e(this).html())});h.push(i)});this.data=h;this.dataCount=h.length;this._setData()},_data_parameters:function(){this.settings.url=this.$element.data("url")?this.$element.data("url"):this.settings.url;if(this.settings.url){this.ajax={url:this.settings.url,data:{}}}},_setData:function(){if(this.ajax){this.currentData=this.data}else{var n=((this.page-1)*this.rows),h=n+this.rows;this.currentData=this.filteredData.length?this.filteredData.slice(n,h):this.data.slice(n,h)}this._remove();for(var m=0;m<this.currentData.length;m++){var o=[];for(var k=0;k<this.currentData[m].length;k++){o.push("<td>"+this.currentData[m][k]+"</td>")}this.$element.find("tbody").append("<tr>"+o.join("")+"</tr>")}this._footer();this._overlayStop()},_remove:function(){this.$element.find("tbody").html("")},_footer:function(){var l=Math.ceil(this.dataCount/(this.rows<=0?1:this.rows)),n=[],k=0,o=0,m=(this.settings.pgn%2)?this.settings.pgn:(this.settings.pgn+1);var j=Math.ceil(m/2);this.page=this.page>l?l:(this.page<=0?1:this.page);if(l<=m||this.page<=j){var h=l>m?m:l;for(o=1;o<=h;o++){n.push(o)}}else{if(this.page>=(l-(j-1))){for(o=l;o>=(l-m);o--){n.push(o)}n.reverse()}else{k=this.page-(j-1);for(o=0;o<m;o++){n.push(k+o)}}}this.$footer.find(".qtable-pd").html("");this.$footer.find(".qtable-pagination").html("");this.$footer.show();if(n.length>1){this.$footer.find(".qtable-pd").html("Page <b>"+this.page+"</b> of <b>"+l+"</b>");if(1<n[0]){this.$footer.find(".qtable-pagination").append('<li><a data-pg="1">|<</a></li>');this.$footer.find(".qtable-pagination").append('<li><a data-pg="'+(this.page-1)+'"><</a></li>')}for(o=0;o<n.length;o++){var i=n[o]==this.page?'class="active"':"";this.$footer.find(".qtable-pagination").append("<li "+i+'><a data-pg="'+n[o]+'">'+n[o]+"</a></li>")}if(l>n[(n.length-1)]){this.$footer.find(".qtable-pagination").append('<li><a data-pg="'+(this.page+1)+'">></a></li>');this.$footer.find(".qtable-pagination").append('<li><a data-pg="'+l+'">>|</a></li>')}}else{this.$footer.hide()}},_actions:function(){var h=this;this.$footer.on("click","li:not(.active) a",function(){h.page=e(this).data("pg");if(h.ajax){h._ajax()}else{h._setData()}});this.$header.on("change","select",function(){h.page=1;h.rows=parseInt(e(this).val());if(h.ajax){h._ajax()}else{h._setData()}});this.$element.on("click","thead>tr>th>a.q-sorter",function(){if(e(this).hasClass("qsort-asc")){e(this).removeClass("qsort-asc").addClass("qsort-desc")}else{if(e(this).hasClass("qsort-desc")){e(this).removeClass("qsort-desc")}else{e(this).addClass("qsort-asc")}}h._sort()});this.$element.on("keyup","thead>tr.q-search input",function(){if(h.settings.searchCharacters>e(this).val().length){return}console.log(e(this).val())})},_sort:function(l){l=l||false;var k=[],j=this;this.$element.find("thead tr a.q-sorter.qsort-asc,thead tr a.q-sorter.qsort-desc").each(function(){if(j.ajax){if(e(this).closest("th,td").data("qname")){k.push([e(this).closest("th,td").data("qname"),(e(this).hasClass("qsort-desc")?"desc":"asc")])}}else{k.push({i:e(this).closest("th,td").index(),o:e(this).hasClass("qsort-desc")})}});if(this.ajax){this.ajax.data.push({order:k});if(l){return}return}if(k.length){this.filteredData=this.data;for(var h=0;h<k.length;h++){this.filteredData.sort(function(n,i){var m=n[k[h].i],o=i[k[h].i];if(k[h].o){m=i[k[h].i];o=n[k[h].i]}if(!isNaN(m)&&!isNaN(o)){return m-o}m=m.toString();o=o.toString();return m.localeCompare(o)})}}else{this.filteredData=[]}this._setData()},_overlayStart:function(){if(!this.overlay){this.overlay=e('<div class="qtable-overlay"><span>Loading Data...</span></div>');this.overlay.prependTo(this.$element.parent())}this.overlay.css({display:"flex"})},_overlayStop:function(){if(this.overlay){this.overlay.css({display:"none"})}}});e.fn[d]=function(h){return this.each(function(){if(!e.data(this,"plugin_"+d)){e.data(this,"plugin_"+d,new b(this,h))}})}})(jQuery,Window,Document);