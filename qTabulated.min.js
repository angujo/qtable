(function(d){var c="qTable",e={url:null,sort:false,search:false,footer_url:null,transistOut:"zoomOut",rowClick:function(f,g){},pageRows:[20,30,50,100],pgn:5,searchCharacters:3};function b(g,f){this.$element=d(g);this.settings=d.extend({},e,f);this._options=f;this.settings.pgn=parseInt(this.settings.pgn)<5?5:parseInt(this.settings.pgn);this.ajax=null;this.page=1;this.pages=0;this.data=[];this.dataCount=0;this.currentData=[];this.filteredData=[];this.overlay=null;this.rows=this.settings.pageRows[0];this._data_parameters();this.init()}d.extend(b.prototype,{init:function(){var i=d('<div class="q-tabulated"></div>'),f=d('<div class="qtable-responsive"></div>'),j=d('<div class="qtable-hc"><label>Rows:<select></select></label></div>'),g=d('<div class="qtable-fc"><div class="qtable-pd"></div><ul class="qtable-pagination"></ul></div>');j.appendTo(i);f.appendTo(i);g.appendTo(i);i.insertAfter(this.$element);this.$element.appendTo(f);this.$header=j;this.$footer=g;this._header();this._body();this._actions()},_header:function(){var o=this,f=[],p=0;for(var l=0;l<this.settings.pageRows.length;l++){this.$header.find("select").append('<option value="'+this.settings.pageRows[l]+'">'+this.settings.pageRows[l]+"</option>")}this.$element.find("thead>tr:last-child>th").each(function(){p++;if(d(this).data("qoptions")){o._qoptions(d(this),f)}});if(f.length){var m=d('<tr class="q-search"></tr>');for(var h=0;h<p;h++){var n="<th></th>";for(var g=0;g<f.length;g++){if(f[g].i==h){n="<th>"+f[g].f+"</th>";f.splice(g,1);break}}m.append(n)}m.insertAfter(this.$element.find("thead>tr:last-child"))}},_qoptions:function(h,j){var f=h.data("qoptions").split(",");for(var g=0;g<f.length;g++){if(this.ajax&&!h.closest("th,td").data("qname").toString().length){continue}switch(f[g].trim()){case"sort":if(h.hasClass("q-sorted")){continue}h.addClass("q-sorted");h.html('<a class="q-sorter" href="javascript:void(0);">'+h.text()+"</a>");break;case"search":if(h.hasClass("q-searched")){continue}h.addClass("q-searched");j.push({i:h.closest("th,td").index(),f:'<input name="'+(h.closest("th,td").data("qname").toString().length&&this.ajax?h.closest("th,td").data("qname"):"")+'">'});break}}},_body:function(){if(!this.$element.find("thead").length){alert("Tables should have <THEAD/> tags!");return}if(!this.$element.find("tbody").length){var f=d("<tbody></tbody>");this.$element.find("thead").siblings().appendTo(f);f.insertAfter(this.$element.find("thead"))}if(this.ajax){this._ajax()}else{this._basic()}},_ajax:function(){var f=this,g={start:((f.page-1)*f.rows),length:f.rows};g=d.extend({},g,this.ajax.data);if(this.ajax.run&&this.ajax.status){this.ajax.run.abort()}this.ajax.run=d.ajax(f.ajax.url,{cache:false,beforeSend:function(){f._overlayStart();f.ajax.status=true},complete:function(){f._overlayStop();f.ajax.status=false},data:{qtable:g},dataType:"json",error:function(){if(!f.ajax.status){alert("Error encountered. Log this on https://github.com/angujo/qtable")}},method:"get",success:function(h){f.data=h.data;f.dataCount=h.rows;f._setData()}})},_basic:function(){this._overlayStart();var f=[];this.$element.find("tbody>tr").each(function(){var g=[];d(this).find("td,th").each(function(){g.push(d(this).html())});f.push(g)});this.data=f;this.dataCount=f.length;this._setData()},_data_parameters:function(){this.settings.url=this.$element.data("url")?this.$element.data("url"):this.settings.url;if(this.settings.url){this.ajax={url:this.settings.url,data:{},run:null,status:false}}},_setData:function(){if(this.ajax){this.currentData=this.data}else{var k=((this.page-1)*this.rows),f=k+this.rows;this.currentData=this.filteredData.length?this.filteredData.slice(k,f):this.data.slice(k,f)}this._remove();for(var h=0;h<this.currentData.length;h++){var m=[];for(var g=0;g<this.currentData[h].length;g++){m.push("<td>"+this.currentData[h][g]+"</td>")}this.$element.find("tbody").append("<tr>"+m.join("")+"</tr>")}this._footer();this._overlayStop()},_remove:function(){this.$element.find("tbody").html("")},_footer:function(){var j=Math.ceil(this.dataCount/(this.rows<=0?1:this.rows)),l=[],i=0,m=0,k=(this.settings.pgn%2)?this.settings.pgn:(this.settings.pgn+1);var h=Math.ceil(k/2);this.page=this.page>j?j:(this.page<=0?1:this.page);if(j<=k||this.page<=h){var f=j>k?k:j;for(m=1;m<=f;m++){l.push(m)}}else{if(this.page>=(j-(h-1))){for(m=j;m>=(j-k);m--){l.push(m)}l.reverse()}else{i=this.page-(h-1);for(m=0;m<k;m++){l.push(i+m)}}}this.$footer.find(".qtable-pd").html("");this.$footer.find(".qtable-pagination").html("");this.$footer.show();if(l.length>1){this.$footer.find(".qtable-pd").html("Page <b>"+this.page+"</b> of <b>"+j+"</b>");if(1<l[0]){this.$footer.find(".qtable-pagination").append('<li><a data-pg="1">|<</a></li>');this.$footer.find(".qtable-pagination").append('<li><a data-pg="'+(this.page-1)+'"><</a></li>')}for(m=0;m<l.length;m++){var g=l[m]==this.page?'class="active"':"";this.$footer.find(".qtable-pagination").append("<li "+g+'><a data-pg="'+l[m]+'">'+l[m]+"</a></li>")}if(j>l[(l.length-1)]){this.$footer.find(".qtable-pagination").append('<li><a data-pg="'+(this.page+1)+'">></a></li>');this.$footer.find(".qtable-pagination").append('<li><a data-pg="'+j+'">>|</a></li>')}}else{this.$footer.hide()}},_actions:function(){var f=this;this.$footer.on("click","li:not(.active) a",function(){f.page=d(this).data("pg");if(f.ajax){f._ajax()}else{f._setData()}});this.$header.on("change","select",function(){f.page=1;f.rows=parseInt(d(this).val());if(f.ajax){f._ajax()}else{f._setData()}});this.$element.on("click","thead>tr>th>a.q-sorter",function(){if(d(this).hasClass("qsort-asc")){d(this).removeClass("qsort-asc").addClass("qsort-desc")}else{if(d(this).hasClass("qsort-desc")){d(this).removeClass("qsort-desc")}else{d(this).addClass("qsort-asc")}}f._sort()});this.$element.on("keyup","thead>tr.q-search input",function(){f._search()})},_search:function(o,g){g=g||false;o=o||false;var n=this.ajax?{}:[],l=this;this.$element.find("thead>tr.q-search input").each(function(){if(!d(this).val()||l.settings.searchCharacters>d(this).val().length){return true}if(l.ajax){if(d(this).attr("name").toString().length){n[d(this).attr("name")]=d(this).val()}}else{n.push({i:d(this).closest("th,td").index(),v:d(this).val()})}});if(this.ajax){this.ajax.data.search=n;if(o){return}this._ajax();return}if(n.length){var m=g?this.filteredData:JSON.parse(JSON.stringify(this.data));this.filteredData=[];for(var h=0;h<m.length;h++){var k=true;for(var f=0;f<n.length;f++){if(m[h][n[f].i].toString().toLowerCase().indexOf(n[f].v.toString().toLowerCase())==-1){k=false;break}}if(k){this.filteredData.push(m[h])}}}else{this.filteredData=g?this.filteredData:[]}this.page=1;this.dataCount=n.length||g?this.filteredData.length:this.data.length;this._setData()},_sort:function(k,f){f=f||false;k=k||false;var j=this.ajax?{}:[],h=this;this.$element.find("thead tr a.q-sorter.qsort-asc,thead tr a.q-sorter.qsort-desc").each(function(){if(h.ajax){if(d(this).closest("th,td").data("qname").toString().length){j[d(this).closest("th,td").data("qname")]=(d(this).hasClass("qsort-desc")?"desc":"asc")}}else{j.push({i:d(this).closest("th,td").index(),o:d(this).hasClass("qsort-desc")})}});if(this.ajax){this.ajax.data.order=j;if(k){return}this._ajax();return}if(j.length){this.filteredData=f?this.filteredData:JSON.parse(JSON.stringify(this.data));for(var g=0;g<j.length;g++){(function(n,l){l.filteredData.sort(function(o,i){var m=o[j[n].i],p=i[j[n].i];if(j[n].o){m=i[j[n].i];p=o[j[n].i]}if(!isNaN(m)&&!isNaN(p)){return m-p}m=m.toString();p=p.toString();return m.localeCompare(p)})})(g,this)}}else{this.filteredData=f?this.filteredData:[]}this._setData()},_overlayStart:function(){if(!this.overlay){this.overlay=d('<div class="qtable-overlay"><span>Loading Data...</span></div>');this.overlay.prependTo(this.$element.parent())}this.overlay.css({display:"flex"})},_overlayStop:function(){if(this.overlay){this.overlay.css({display:"none"})}}});var a={gotoPage:function(f){this.page=f;if(this.ajax){this._ajax()}else{this._setData()}},reload:function(){var g=this._options,f=this.$element;this.destroy();f.qTable(g)},refresh:function(){this.reload()},destroy:function(){this.$element.insertAfter(this.$header.parent());this.$header.parent().remove();this.$element.find("thead>tr.q-search").remove();this.$element.find(".q-searched").removeClass("q-searched");this.$element.find(".q-sorted").each(function(){d(this).html(d(this).find(".q-sorter").html()).removeClass("q-sorted")});if(this.ajax){}else{this.rows=this.data.length;this.page=1;this._setData()}d.removeData(this.$element.get(0),"plugin_"+c)},tester:function(){console.log(arguments)}};d.fn[c]=function(h,f){var g=arguments;return this.each(function(){if(!d(this).is("table")){return true}if((!h||(h&&typeof h=="object")||"create"==h)&&!d.data(this,"plugin_"+c)){d.data(this,"plugin_"+c,new b(this,h))}else{if(a[h]){if(!d.data(this,"plugin_"+c)){return true}g=d.map(g,function(i){return i});g.shift();a[h].apply(d.data(this,"plugin_"+c),g)}}})}})(jQuery,Window,Document);